<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Slatetruckstudios Employee Portal</title>
  <style>
    :root { --primary-red:#d90429; --black:#0b0b0b; --dark-gray:#1a1a1a; --light-gray:#e5e5e5; }
    body { margin:0; font-family:Arial,sans-serif; background:var(--dark-gray); color:white; }
    header { background:var(--black); padding:20px; display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid var(--primary-red); }
    header img { height:40px; }
    header h1 { margin:0; font-size:20px; letter-spacing:2px; color:var(--primary-red); }
    .container { padding:40px; max-width:1000px; margin:0 auto; }
    .card { background:var(--black); border:1px solid var(--primary-red); border-radius:8px; padding:25px; margin-bottom:20px; box-shadow:0 0 20px rgba(217,4,41,0.4); }
    .card h2 { margin-top:0; color:var(--primary-red); }
    button { background:var(--primary-red); border:none; padding:10px 16px; color:white; border-radius:6px; cursor:pointer; transition:0.3s; font-weight:bold; }
    button:hover{ background:#b10321; transform:scale(1.05); }
    footer{ background:var(--black); padding:15px; text-align:center; border-top:2px solid var(--primary-red); color:var(--light-gray);} 
  </style>
</head>
<body>
  <header>
    <img src="https://static.wixstatic.com/media/1a6956_64fdf70e836a4c1f8fedfcc34751971e~mv2.png/v1/fill/w_176,h_41,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/1a6956_64fdf70e836a4c1f8fedfcc34751971e~mv2.png" />
    <h1>Employee Portal</h1>
    <button id="logoutBtn" onclick="logout()" style="display:none;">Logout</button>
  </header>

  <div class="container" id="content"></div>

  <footer>© <span id="year"></span> Slatetruckstudios — Internal Use Only</footer>

  <script src="https://cdn.auth0.com/js/auth0-spa-js/2.6/auth0-spa-js.production.js"></script>

  <script>
    const yearSpan = document.getElementById("year");
    yearSpan.textContent = new Date().getFullYear();

    const allowedUsers = [
      "naledbetter", "naledbetter@slatetruckstudios.com",
      "pmnitzel", "pmnitzel@slatetruckstudios.com"
    ];

    let auth0Client;

    async function initAuth0() {
      try {
        auth0Client = await createAuth0Client({
          domain: 'dev-8l6bzbrqo1exjrlb.us.auth0.com',
          client_id: 'ntb2w9GWTKuKN4HbcDrvKM8FYz6imuk0',
          cacheLocation: 'localstorage',
          authorizationParams: { redirect_uri: window.location.origin }
        });

        if (window.location.search.includes('code=') && window.location.search.includes('state=')) {
          await auth0Client.handleRedirectCallback();
          window.history.replaceState({}, document.title, window.location.pathname);
        }

        await renderUI();
      } catch (err) {
        console.error('Auth0 initialization error:', err);
        document.getElementById('content').innerHTML = `<div class='card'><h2>Error</h2><p>Authentication initialization failed. Check console.</p></div>`;
      }
    }

    async function renderUI() {
      const content = document.getElementById('content');
      const logoutBtn = document.getElementById('logoutBtn');
      const isAuthenticated = await auth0Client.isAuthenticated();

      if (!isAuthenticated) {
        content.innerHTML = `<div class='card'><h2>Welcome</h2><p>Please log in to access the Slatetruckstudios Employee Portal.</p><button id='loginBtn'>Login</button></div>`;
        logoutBtn.style.display = 'none';
        document.getElementById('loginBtn').addEventListener('click', () => auth0Client.loginWithRedirect());
        return;
      }

      const user = await auth0Client.getUser();

      if (!allowedUsers.includes(user.email) && !allowedUsers.includes(user.nickname)) {
        content.innerHTML = `<div class='card'><h2>Access Denied</h2><p>You are not authorized to access this portal.</p></div>`;
        logoutBtn.style.display = 'inline-block';
        return;
      }

      logoutBtn.style.display = 'inline-block';
      content.innerHTML = `<div class='card'><h2>Hello, ${user.name || user.email}</h2><p>Welcome to the internal employee dashboard.</p></div>
      <div class='card'><h2>Company Resources</h2><ul>
        <li><a href='#' style='color: var(--primary-red);'>Payroll</a></li>
        <li><a href='#' style='color: var(--primary-red);'>Schedule</a></li>
        <li><a href='#' style='color: var(--primary-red);'>Internal Handbook</a></li>
      </ul></div>`;
    }

    async function logout() {
      await auth0Client.logout({ logoutParams: { returnTo: window.location.origin } });
      await renderUI();
    }

    window.onload = initAuth0;
  </script>
</body>
</html>
